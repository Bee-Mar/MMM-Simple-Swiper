#+TITLE: MMM-Simple-Swiper Installation Guide
#+AUTHOR: Brandon Marlowe
#+DATE: 2019-02-01
#+OPTIONS: toc:nil

* Before getting started...

  1) This installation was done on a _Raspberry Pi 3 B_ running Raspbian
     * The board was _BRAND NEW_ and the OS was _FRESHLY_ installed
     * The installation occurred after the initial boot and initial update
       + =Remote GPIO= and =SSH= were enabled under =raspi-config=
       + (You can enable them as well, if you would like to by following below)
         1) Open a terminal window
         2) run =sudo raspi-config=
         3) select =Interfacing Options=, select =SSH=; select =<YES>= to enable
         4) Also within =Interfacing Options=; select =Remote GPIO=; select =<YES>= to enable 

       + I created SSH keys & copied them to my desktop (for easier SSHing)
         * For information on how to do this, see: https://www.ssh.com/ssh/keygen/
       + Otherwise, nothing else beyond what is shown was installed or removed

  2) I used my desktop to SSH into the Pi and record the installation
     * The Pi cannot handle screen recording + installation of MagicMirror very well

  3) All of these steps can be replicated directly from the Raspberry Pi 3 B in a terminal

  4) There were no steps skipped throughout the video

  5) Only, some portions of video were sped up (installation processes)

  6) An image of the pin connections for the HC-SR04 Sensors is our GitHub page

  7) Instructions for the =Required Packages= are from the relevant Github pages

  8) The Required Packages are the _BARE MINIMUM_ to get this working

  9) _NOTE_: Within the Basic MagicMirror Config Setup
     * There are default modules, which can be removed, if desired (see below)


* Required Packages
** NodeJS (10.15 or higher)
   #+BEGIN_SRC sh

     # taken from: https://github.com/MichMich/MagicMirror

     curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -

     sudo apt install nodejs -y

   #+END_SRC

** MagicMirror
   #+BEGIN_SRC sh

     cd ~/

     git clone https://github.com/MichMich/MagicMirror

     cd ~/MagicMirror

     npm install

     # for the moment, don’t start the MagicMirror

   #+END_SRC

** MMM-pages
   #+BEGIN_SRC sh

     cd ~/MagicMirror/modules/

     git clone https://github.com/edward-shen/MMM-pages.git

     cd ~/MagicMirror/modules/MMM-pages
     
     npm install

   #+END_SRC

** MMM-page-indicator
   #+BEGIN_SRC sh

     cd ~/MagicMirror/modules/

     git clone https://github.com/edward-shen/MMM-page-indicator.git

     # this module has no package.json, so "npm install" is not needed

   #+END_SRC

** MMM-Simple-Swiper
   #+BEGIN_SRC sh

     cd ~/MagicMirror/modules

     git clone https://github.com/Bee-Mar/MMM-Simple-Swiper.git

     cd ~/MagicMirror/modules/MMM-Simple-Swiper

     # ONLY DO THIS IF YOU DON’T ALREADY HAVE A CONFIG SETUP
     cp step-by-step-instructions/SAMPLE_CONFIG.js ~/MagicMirror/config/
     # otherwise, simply examine the file, and see what is required

     # installing dependencies
     make install

     # compile executable
     make

     # OPTIONAL: To test the module, follow below
     cd ~/MagicMirror/modules/MMM-Simple-Swiper/
     make debug
     sudo ./swiper "{echoLeftPin: 24, triggerLeftPin: 23, echoRightPin: 26, triggerRightPin: 25, threshold: 175, distanceDiff: 1.25, debug: false, delay: 750, }"
     
     # to see if the module is running, run this in a terminal
     ps -ef | egrep -i "sudo\s+.*./MMM-Simple-Swiper/swiper"


   #+END_SRC


* Basic config.js that contains setup of required modules
  #+BEGIN_SRC js
    /* Magic Mirror Config Sample
     ,*
     ,* By Michael Teeuw http://michaelteeuw.nl
     ,* MIT Licensed.
     ,*
     ,* For more information how you can configurate this file
     ,* See https://github.com/MichMich/MagicMirror#configuration
     ,*
     ,*/

    var config = {
      address: "localhost", // Address to listen on, can be:
      // - "localhost", "127.0.0.1", "::1" to listen on loopback interface
      // - another specific IPv4/6 to listen on a specific interface
      // - "", "0.0.0.0", "::" to listen on any interface
      // Default, when address config is left out, is "localhost"
      port: 8080,
      ipWhitelist: ["127.0.0.1", "::ffff:127.0.0.1", "::1"], // Set [] to allow all IP addresses
      // or add a specific IPv4 of 192.168.1.5 :
      // ["127.0.0.1", "::ffff:127.0.0.1", "::1", "::ffff:192.168.1.5"],
      // or IPv4 range of 192.168.3.0 --> 192.168.3.15 use CIDR format :
      // ["127.0.0.1", "::ffff:127.0.0.1", "::1", "::ffff:192.168.3.0/28"],

      language: "en",
      timeFormat: 24,
      units: "metric",

      modules: [
        {
          module: "MMM-pages", // REQUIRED
          config: {
            modules: [
              [
                "weatherforecast", // feel free to remove or swap out
                "newsfeed", // feel free to remove or swap out
              ],
              [
                "calendar", // feel free to remove or swap out
                "compliments", // feel free to remove or swap out
              ],
            ],
            excludes: [
              "clock", // feel free to remove or swap out
              "currentweather", // feel free to remove or swap out
              "MMM-page-indicator", // REQUIRED
              "MMM-Simple-Swiper", // REQUIRED
            ],
          },
        },
        {
          module: "MMM-page-indicator", //REQUIRED
          position: "bottom_bar", // feel free to adjust
          config: {
            pages: 3, // feel free to adjust
          },
        },
        {
          module: "MMM-Simple-Swiper",
          disabled: false,
          config: {
            echoLeftPin: 24, // GPIO #
            triggerLeftPin: 23, // GPIO #
            echoRightPin: 26, // GPIO #
            triggerRightPin: 25, // GPIO #
            threshold: 175, // in centimeters
            distanceDiff: 1.25, // difference between both sensors
            debug: false, // if true, the raw data is printed to stdout while MagicMirror is running
            delay: 1000, // time between passing data from C executable to the node_helper in milliseconds
          },
        },
        {
          module: "alert", // feel free to remove or swap out
          disabled: false,      
        },
        {
          module: "updatenotification", // feel free to remove or swap out
          position: "top_bar",
          disabled: false,      
        },
        {
          module: "clock", // feel free to remove or swap out
          position: "top_right",
          timeFormat: 12,
          showPeriodUpper: true,
          disabled: false,
        },
        {
          module: "calendar", // feel free to remove or swap out
          header: "US Holidays",
          position: "top_right",
          disabled: false,      
          config: {
            calendars: [
              {
                symbol: "calendar-check-o ",
                url: "webcal://www.calendarlabs.com/templates/ical/US-Holidays.ics",
              },
            ],
          },
        },

        {
          module: "compliments", // feel free to remove or swap out
          position: "lower_third",
          disabled: true,
        },

        {
          module: "weatherforecast", // feel free to remove or swap out
          position: "top_right",
          header: "Weather Forecast",
          disabled: false,      
          config: {
            location: "New York, NY, USA",
            units: "imperial",
            appid: "c0520f8e8537b2c7555a9f7d5c2d53ec",
          },
        },

        {
          module: "currentweather", // feel free to remove or swap out
          position: "top_right",
          disabled: false,      
          config: {
            location: "New York, NY, USA",
            units: "imperial",
            appid: "c0520f8e8537b2c7555a9f7d5c2d53ec",
          },
        },

        {
          module: "newsfeed", // feel free to remove or swap out
          position: "bottom_bar",
          config: {
            feeds: [
              {
                title: "New York Times",
                url: "http://www.nytimes.com/services/xml/rss/nyt/HomePage.xml",
              },
              {
                title: "CNET",
                url: "https://www.cnet.com/rss/news/",
              },
              {
                title: "TechRepublic",
                url: "https://www.techrepublic.com/rssfeeds/articles/",
              },
            ],
            showSourceTitle: true,
            showPublishDate: true,
          },
        },
      ],
    };

    /*************** DO NOT EDIT THE LINE BELOW ***************/
    if (typeof module !== "undefined") {
      module.exports = config;
    }
  #+END_SRC


* Start MagicMirror
   #+BEGIN_SRC sh

     cd ~/MagicMirror

     npm start

     # check to ensure the MMM-Simple-Swiper module is running
     ps -ef | egrep -i "sudo\s+.*./MMM-Simple-Swiper/swiper"

     # if it is running, you should see an output similar to this
     sudo /home/pi/MagicMirror/modules/MMM-Simple-Swiper/main {"echoLeftPin":24,"triggerLeftPin":23,"echoRightPin":26,"triggerRightPin":25,"threshold":175,"distanceDiff":1.25,"debug":false,"delay":1000}

     # depending on the arguments provided to the config, your JSON string may differ

   #+END_SRC
